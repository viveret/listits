<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listits v1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        #app {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .group {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .group-title {
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-title {
            font-weight: bold;
            margin-top: 10px;
        }

        .item {
            padding: 5px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .item.done {
            background-color: #e0ffe0;
        }

        button {
            margin: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .btn-danger {
            background-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .filter-buttons, .import-export-buttons {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Listits v1</h1>
        <a href="https://github.com/viveret/listits" target="_blank">View Source</a>
        <div class="import-export-buttons">
            <button onclick="importData()">Import Data</button>
            <button onclick="exportData()">Export Data</button>
        </div>
        <div class="filter-buttons">
            <button onclick="setFilter('all')">Show All</button>
            <button onclick="setFilter('done')">Show Only Done</button>
            <button onclick="setFilter('not-done')">Show Only Not Done</button>
        </div>
        <button onclick="createNewGroup()">Add New Group</button>
        <div id="groups-container"></div>
    </div>
    <script>
        const generateId = () => '_' + Math.random().toString(36).substr(2, 9);

        const loadGroups = () => {
            const json = localStorage.getItem('listitsGroups');
            if (json && json !== 'undefined') {
                const data = JSON.parse(json);
                if (data && data.length !== 0) {
                    return data;
                }
            }
            
            return initializeDefaultGroups();
        };

        const initializeDefaultGroups = () => {
            const defaultGroups = [
                {
                    id: generateId(),
                    name: 'Favorite Reads',
                    lists: [
                        { id: generateId(), name: 'Books', items: [] },
                        { id: generateId(), name: 'Zines', items: [] }
                    ]
                },
                {
                    id: generateId(),
                    name: 'To Do',
                    lists: [
                        { id: generateId(), name: 'At Home', items: [] },
                        { id: generateId(), name: 'Outside', items: [] }
                    ]
                }
            ];
            localStorage.setItem('listitsGroups', JSON.stringify(defaultGroups));
            return defaultGroups;
        };

        let groups = loadGroups();
        let filter = 'all';

        const promptInput = (message, defaultValue = '') => prompt(message, defaultValue) || '';

        const setFilter = (newFilter) => {
            filter = newFilter;
            render();
        };

        const saveAndRender = () => {
            localStorage.setItem('listitsGroups', JSON.stringify(groups));
            render();
        };

        const createItem = (parent, itemName, itemType) => {
            const name = promptInput(`Enter ${itemName} name:`);
            if (name) {
                switch (itemType) {
                    case 'item': {
                        const description = promptInput(`Enter ${itemName} description:`)
                        parent.push({ id: generateId(), name, description, done: false, notes: '' });
                    } break;
                    case 'group':{
                        parent.push({ id: generateId(), name, lists: [] });
                    } break;
                    case 'list': {
                        parent.push({ id: generateId(), name, items: [] });
                    } break;
                    default: {
                        throw new Error(`unknown type ${itemType}`);
                    }
                }
                saveAndRender();
            }
        };

        const deleteItem = (parent, itemId) => {
            const index = parent.findIndex(item => item.id === itemId);
            if (index !== -1) {
                parent.splice(index, 1);
                saveAndRender();
            }
        };

        const toggleDoneStatus = (item) => {
            item.done = !item.done;
            saveAndRender();
        };

        const editNotes = (item) => {
            const notes = promptInput('Edit notes:', item.notes);
            if (notes !== null) {
                item.notes = notes;
                saveAndRender();
            }
        };

        const render = () => {
            const container = document.getElementById('groups-container');
            container.innerHTML = '';
            groups.forEach(group => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'group';
                groupDiv.innerHTML = `
                    <div class="group-title">
                        ${group.name}
                        <button class="btn-danger" onclick="deleteGroup('${group.id}')">Delete Group</button>
                    </div>
                    <button onclick="createList('${group.id}')">Add New List</button>
                `;
                group.lists.forEach(list => {
                    const listDiv = document.createElement('div');
                    listDiv.className = 'list';
                    listDiv.innerHTML = `
                        <div class="list-title">
                            ${list.name}
                            <button class="btn-danger" onclick="deleteList('${group.id}', '${list.id}')">Delete List</button>
                        </div>
                        <button onclick="createItemInList('${group.id}', '${list.id}')">Add New Item</button>
                    `;
                    list.items.forEach(item => {
                        if (filter === 'all' || (filter === 'done' && item.done) || (filter === 'not-done' && !item.done)) {
                            const itemDiv = document.createElement('div');
                            const notes = item.notes ? `<div>Your notes: <i>"${item.notes}"</i></div>` : '';
                            itemDiv.className = `item ${item.done ? 'done' : ''}`;
                            itemDiv.innerHTML = `
                                <div>
                                    <div>
                                        <strong>${item.name}</strong> - ${item.description}
                                    </div>
                                    ${notes}
                                </div>
                                <div>
                                    <button onclick="toggleDoneStatusInList('${group.id}', '${list.id}', '${item.id}')">
                                        ${item.done ? 'Not Done' : 'Done'}
                                    </button>
                                    <button onclick="editNotesInList('${group.id}', '${list.id}', '${item.id}')">Edit Notes</button>
                                    <button class="btn-danger" onclick="deleteItemInList('${group.id}', '${list.id}', '${item.id}')">Delete</button>
                                </div>
                            `;
                            listDiv.appendChild(itemDiv);
                        }
                    });
                    groupDiv.appendChild(listDiv);
                });
                container.appendChild(groupDiv);
            });
        };

        const createNewGroup = () => createItem(groups, 'group', 'group');
        const deleteGroup = (groupId) => deleteItem(groups, groupId);
        const createList = (groupId) => createItem(groups.find(g => g.id === groupId).lists, 'list', 'list');
        const deleteList = (groupId, listId) => deleteItem(groups.find(g => g.id === groupId).lists, listId);
        const createItemInList = (groupId, listId) => createItem(groups.find(g => g.id === groupId).lists.find(l => l.id === listId).items, 'item', 'item');
        const deleteItemInList = (groupId, listId, itemId) => deleteItem(groups.find(g => g.id === groupId).lists.find(l => l.id === listId).items, itemId);
        const toggleDoneStatusInList = (groupId, listId, itemId) => toggleDoneStatus(groups.find(g => g.id === groupId).lists.find(l => l.id === listId).items.find(i => i.id === itemId));
        const editNotesInList = (groupId, listId, itemId) => editNotes(groups.find(g => g.id === groupId).lists.find(l => l.id === listId).items.find(i => i.id === itemId));

        // Function to export data from localStorage
        const exportData = () => {
            const groupsData = localStorage.getItem('listitsGroups');
            if (groupsData) {
                prompt('Copy this data:', groupsData);
            }
        };

        // Function to import data into localStorage
        const importData = () => {
            try {
                const jsonData = prompt('Paste your data:');
                localStorage.setItem('listitsGroups', jsonData);
                groups = loadGroups();
                render();
            } catch (error) {
                console.error('Error importing data:', error);
            }
        };

        document.addEventListener('DOMContentLoaded', render);
    </script>
</body>
</html>
